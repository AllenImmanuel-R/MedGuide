<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hybrid Tamil-English Voice Test - MedGuide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            max-width: 900px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .title {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .language-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .lang-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .lang-btn.active {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            border-color: #4CAF50;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
        
        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            background: linear-gradient(45deg, #6a1b9a, #8e24aa);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(106, 27, 154, 0.4);
        }
        
        .control-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .recording {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .status-panel {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #4CAF50;
        }
        
        .status-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .status-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .status-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
        }
        
        .status-label {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .status-value {
            font-size: 16px;
            font-weight: bold;
        }
        
        .confidence-high { color: #4CAF50; }
        .confidence-medium { color: #FF9800; }
        .confidence-low { color: #f44336; }
        
        .transcript-panel {
            background: rgba(255, 255, 255, 0.15);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            min-height: 150px;
            border-left: 5px solid #2196F3;
        }
        
        .transcript-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .transcript-content {
            font-size: 18px;
            line-height: 1.6;
            min-height: 100px;
        }
        
        .final-text {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .interim-text {
            color: #ffeb3b;
            font-style: italic;
        }
        
        .language-switch-alert {
            background: rgba(255, 152, 0, 0.2);
            border: 2px solid #FF9800;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .switch-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .switch-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .switch-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .sample-phrases {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .phrases-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .phrase-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
        }
        
        .phrase {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        
        .phrase:hover {
            background: rgba(255, 255, 255, 0.2);
            border-left-color: #4CAF50;
            transform: translateX(5px);
        }
        
        .phrase-lang {
            font-size: 11px;
            opacity: 0.7;
            margin-bottom: 5px;
        }
        
        .phrase-text {
            font-size: 14px;
        }
        
        .error-panel {
            background: rgba(244, 67, 54, 0.2);
            border: 2px solid #f44336;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                width: 95%;
            }
            
            .title {
                font-size: 2em;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .control-btn {
                width: 100%;
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">üé§üåê Hybrid Voice Test</div>
            <div class="subtitle">Tamil + English Speech Recognition for MedGuide</div>
        </div>

        <!-- Language Selector -->
        <div class="language-selector">
            <button class="lang-btn active" data-lang="ta-IN">üáÆüá≥ ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</button>
            <button class="lang-btn" data-lang="en-IN">üáÆüá≥ English (India)</button>
            <button class="lang-btn" data-lang="en-US">üá∫üá∏ English (US)</button>
        </div>

        <!-- Controls -->
        <div class="controls">
            <button id="startBtn" class="control-btn">üéôÔ∏è Start Recording</button>
            <button id="stopBtn" class="control-btn" disabled>üî¥ Stop Recording</button>
            <button id="clearBtn" class="control-btn">üóëÔ∏è Clear</button>
        </div>

        <!-- Status Panel -->
        <div class="status-panel">
            <div class="status-title">üìä Recording Status</div>
            <div class="status-info">
                <div class="status-item">
                    <div class="status-label">Current Language</div>
                    <div class="status-value" id="currentLang">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Recording State</div>
                    <div class="status-value" id="recordingState">Ready</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Confidence Level</div>
                    <div class="status-value" id="confidenceLevel">-</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Fallback Attempts</div>
                    <div class="status-value" id="fallbackAttempts">0</div>
                </div>
            </div>
        </div>

        <!-- Language Switch Alert -->
        <div id="languageSwitchAlert" class="language-switch-alert" style="display: none;">
            <div id="switchMessage">üîÑ Tamil recognition confidence is low. Switch to English for better accuracy?</div>
            <div class="switch-buttons">
                <button class="switch-btn" onclick="switchToEnglish()">üáÆüá≥ Switch to English</button>
                <button class="switch-btn" onclick="retryTamil()">üîÑ Retry Tamil</button>
                <button class="switch-btn" onclick="dismissAlert()">‚úñÔ∏è Dismiss</button>
            </div>
        </div>

        <!-- Error Panel -->
        <div id="errorPanel" class="error-panel" style="display: none;">
            <div id="errorMessage"></div>
        </div>

        <!-- Transcript Panel -->
        <div class="transcript-panel">
            <div class="transcript-title">üí¨ Real-time Transcription</div>
            <div class="transcript-content" id="transcriptContent">
                <em>Start recording to see your speech transcribed here...</em>
            </div>
        </div>

        <!-- Sample Phrases -->
        <div class="sample-phrases">
            <div class="phrases-title">üó£Ô∏è Try These Medical Phrases</div>
            <div class="phrase-grid">
                <div class="phrase" onclick="speakPhrase(this)">
                    <div class="phrase-lang">Tamil</div>
                    <div class="phrase-text">‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç, ‡Æé‡Æ©‡Æï‡Øç‡Æï‡ØÅ ‡Æ§‡Æ≤‡Øà‡Æµ‡Æ≤‡Æø ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æø‡Æ±‡Æ§‡ØÅ</div>
                </div>
                <div class="phrase" onclick="speakPhrase(this)">
                    <div class="phrase-lang">English</div>
                    <div class="phrase-text">Hello, I have a headache</div>
                </div>
                <div class="phrase" onclick="speakPhrase(this)">
                    <div class="phrase-lang">Tamil</div>
                    <div class="phrase-text">‡Æé‡Æ©‡Øç ‡Æâ‡Æü‡Æ≤‡Øç‡Æ®‡Æ≤‡ÆÆ‡Øç ‡Æé‡Æ™‡Øç‡Æ™‡Æü‡Æø ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ?</div>
                </div>
                <div class="phrase" onclick="speakPhrase(this)">
                    <div class="phrase-lang">English</div>
                    <div class="phrase-text">How is my health condition?</div>
                </div>
                <div class="phrase" onclick="speakPhrase(this)">
                    <div class="phrase-lang">Tamil</div>
                    <div class="phrase-text">‡Æï‡Ææ‡ÆØ‡Øç‡Æö‡Øç‡Æö‡Æ≤‡Øç ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æø‡Æ±‡Æ§‡ØÅ, ‡Æé‡Æ©‡Øç‡Æ© ‡Æö‡ØÜ‡ÆØ‡Øç‡Æµ‡Æ§‡ØÅ?</div>
                </div>
                <div class="phrase" onclick="speakPhrase(this)">
                    <div class="phrase-lang">English</div>
                    <div class="phrase-text">I have fever, what should I do?</div>
                </div>
            </div>
        </div>

        <!-- Statistics -->
        <div class="stats-panel">
            <div class="stat-card">
                <div class="stat-number" id="totalRecordings">0</div>
                <div class="stat-label">Total Recordings</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="successfulRecognitions">0</div>
                <div class="stat-label">Successful Recognitions</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="averageConfidence">0%</div>
                <div class="stat-label">Average Confidence</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="languageSwitches">0</div>
                <div class="stat-label">Language Switches</div>
            </div>
        </div>
    </div>

    <script type="module">
        // Import the HybridVoiceService (simulate module import)
        class HybridVoiceTestService {
            constructor() {
                this.recognition = null;
                this.isRecording = false;
                this.currentLanguage = 'ta-IN';
                this.supportedLanguages = {
                    'ta-IN': { name: '‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç', flag: 'üáÆüá≥', code: 'ta-IN' },
                    'en-IN': { name: 'English (India)', flag: 'üáÆüá≥', code: 'en-IN' },
                    'en-US': { name: 'English (US)', flag: 'üá∫üá∏', code: 'en-US' }
                };
                this.confidenceThreshold = 0.6;
                this.autoSwitchEnabled = true;
                this.fallbackAttempts = 0;
                this.maxFallbackAttempts = 2;
                
                this.stats = {
                    totalRecordings: 0,
                    successfulRecognitions: 0,
                    totalConfidence: 0,
                    languageSwitches: 0
                };
                
                this.callbacks = {
                    onStart: null,
                    onResult: null,
                    onEnd: null,
                    onError: null,
                    onLanguageSwitch: null
                };
            }

            setCallbacks(callbacks) {
                this.callbacks = { ...this.callbacks, ...callbacks };
            }

            setLanguage(languageCode) {
                if (this.supportedLanguages[languageCode]) {
                    this.currentLanguage = languageCode;
                    console.log(`üåê Language switched to: ${this.supportedLanguages[languageCode].name}`);
                    
                    if (this.callbacks.onLanguageSwitch) {
                        this.callbacks.onLanguageSwitch(languageCode, this.supportedLanguages[languageCode]);
                    }
                    
                    this.stats.languageSwitches++;
                }
            }

            setupRecognition() {
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    throw new Error('Speech recognition not supported');
                }

                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                this.recognition = new SpeechRecognition();
                
                this.recognition.continuous = true;
                this.recognition.interimResults = true;
                this.recognition.lang = this.currentLanguage;
                this.recognition.maxAlternatives = 3;

                this.recognition.onstart = () => {
                    this.isRecording = true;
                    this.fallbackAttempts = 0;
                    this.stats.totalRecordings++;
                    
                    console.log(`üéôÔ∏è Recording started in ${this.supportedLanguages[this.currentLanguage].name}`);
                    
                    if (this.callbacks.onStart) {
                        this.callbacks.onStart(this.currentLanguage);
                    }
                };

                this.recognition.onresult = (event) => {
                    let finalTranscript = '';
                    let interimTranscript = '';
                    let maxConfidence = 0;

                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const result = event.results[i];
                        const transcript = result[0].transcript;
                        const confidence = result[0].confidence || 0.5;

                        if (result.isFinal) {
                            finalTranscript += transcript;
                            maxConfidence = Math.max(maxConfidence, confidence);
                            
                            // Track successful recognition
                            if (confidence > 0.3) {
                                this.stats.successfulRecognitions++;
                                this.stats.totalConfidence += confidence;
                            }

                            // Check if Tamil confidence is low and suggest switch
                            if (this.currentLanguage === 'ta-IN' && 
                                confidence < this.confidenceThreshold && 
                                this.autoSwitchEnabled &&
                                this.fallbackAttempts < this.maxFallbackAttempts) {
                                
                                console.log(`‚ö†Ô∏è Tamil confidence low (${confidence.toFixed(2)}), suggesting English fallback`);
                                this.suggestLanguageSwitch();
                                return;
                            }

                            console.log(`üìù Final: "${finalTranscript}" (confidence: ${confidence.toFixed(2)})`);
                        } else {
                            interimTranscript += transcript;
                        }
                    }

                    if (this.callbacks.onResult) {
                        this.callbacks.onResult({
                            finalTranscript,
                            interimTranscript,
                            confidence: maxConfidence,
                            language: this.currentLanguage
                        });
                    }
                };

                this.recognition.onerror = (event) => {
                    console.error('üö´ Recognition error:', event.error);
                    
                    let errorMessage = '';
                    let shouldSuggestFallback = false;

                    switch (event.error) {
                        case 'no-speech':
                            errorMessage = 'No speech detected. Please try again.';
                            break;
                        case 'audio-capture':
                            errorMessage = 'Could not capture audio. Please check your microphone.';
                            break;
                        case 'not-allowed':
                            errorMessage = 'Microphone permission required. Please grant access.';
                            break;
                        case 'language-not-supported':
                            errorMessage = 'Language not supported. Switching to English.';
                            shouldSuggestFallback = true;
                            break;
                        default:
                            errorMessage = `Voice recording error: ${event.error}`;
                            shouldSuggestFallback = this.currentLanguage === 'ta-IN';
                    }

                    if (shouldSuggestFallback && this.autoSwitchEnabled) {
                        this.suggestLanguageSwitch();
                    }

                    if (this.callbacks.onError) {
                        this.callbacks.onError({
                            error: event.error,
                            message: errorMessage,
                            language: this.currentLanguage,
                            suggestFallback: shouldSuggestFallback
                        });
                    }
                };

                this.recognition.onend = () => {
                    this.isRecording = false;
                    console.log('üî¥ Recording ended');
                    
                    if (this.callbacks.onEnd) {
                        this.callbacks.onEnd();
                    }
                };
            }

            suggestLanguageSwitch() {
                this.fallbackAttempts++;
                
                if (this.fallbackAttempts <= this.maxFallbackAttempts) {
                    console.log('üîÑ Suggesting language switch to English');
                    
                    if (this.callbacks.onLanguageSwitch) {
                        this.callbacks.onLanguageSwitch('suggest-english', {
                            currentLang: this.currentLanguage,
                            suggestedLang: 'en-IN',
                            reason: 'low-confidence',
                            attempts: this.fallbackAttempts
                        });
                    }
                }
            }

            async startRecording() {
                if (this.isRecording) {
                    console.log('‚ö†Ô∏è Recording already in progress');
                    return false;
                }

                try {
                    if (!this.recognition) {
                        this.setupRecognition();
                    }

                    this.recognition.lang = this.currentLanguage;
                    this.recognition.start();
                    return true;
                } catch (error) {
                    console.error('‚ùå Failed to start recording:', error);
                    return false;
                }
            }

            stopRecording() {
                if (this.recognition && this.isRecording) {
                    this.recognition.stop();
                    return true;
                }
                return false;
            }

            getStats() {
                return {
                    ...this.stats,
                    averageConfidence: this.stats.successfulRecognitions > 0 
                        ? (this.stats.totalConfidence / this.stats.successfulRecognitions * 100).toFixed(1) + '%'
                        : '0%',
                    isRecording: this.isRecording,
                    currentLanguage: this.currentLanguage,
                    fallbackAttempts: this.fallbackAttempts
                };
            }
        }

        // Initialize the test
        const voiceService = new HybridVoiceTestService();
        let currentTranscript = '';
        let finalTranscript = '';

        // UI Elements
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const clearBtn = document.getElementById('clearBtn');
        const langButtons = document.querySelectorAll('.lang-btn');
        const transcriptContent = document.getElementById('transcriptContent');
        const languageSwitchAlert = document.getElementById('languageSwitchAlert');
        const errorPanel = document.getElementById('errorPanel');

        // Status elements
        const currentLangEl = document.getElementById('currentLang');
        const recordingStateEl = document.getElementById('recordingState');
        const confidenceLevelEl = document.getElementById('confidenceLevel');
        const fallbackAttemptsEl = document.getElementById('fallbackAttempts');

        // Stats elements
        const totalRecordingsEl = document.getElementById('totalRecordings');
        const successfulRecognitionsEl = document.getElementById('successfulRecognitions');
        const averageConfidenceEl = document.getElementById('averageConfidence');
        const languageSwitchesEl = document.getElementById('languageSwitches');

        function updateStats() {
            const stats = voiceService.getStats();
            totalRecordingsEl.textContent = stats.totalRecordings;
            successfulRecognitionsEl.textContent = stats.successfulRecognitions;
            averageConfidenceEl.textContent = stats.averageConfidence;
            languageSwitchesEl.textContent = stats.languageSwitches;
            fallbackAttemptsEl.textContent = stats.fallbackAttempts;
        }

        function updateStatus(state, confidence = null) {
            recordingStateEl.textContent = state;
            
            if (confidence !== null) {
                const confidencePercent = Math.round(confidence * 100);
                confidenceLevelEl.textContent = `${confidencePercent}%`;
                confidenceLevelEl.className = `status-value ${
                    confidence > 0.7 ? 'confidence-high' : 
                    confidence > 0.4 ? 'confidence-medium' : 'confidence-low'
                }`;
            } else {
                confidenceLevelEl.textContent = '-';
                confidenceLevelEl.className = 'status-value';
            }
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            errorPanel.style.display = 'block';
            setTimeout(() => {
                errorPanel.style.display = 'none';
            }, 5000);
        }

        function updateTranscript() {
            let html = '';
            
            if (finalTranscript || currentTranscript) {
                if (finalTranscript) {
                    html += `<span class="final-text">${finalTranscript}</span>`;
                }
                if (currentTranscript) {
                    html += `<span class="interim-text">${currentTranscript}</span>`;
                }
                
                html += '<div style="margin-top: 15px; font-size: 12px; color: #ccc;">';
                html += '<em>Green = Final recognition | Yellow = In progress</em>';
                html += '</div>';
            } else {
                html = '<em>Start recording to see your speech transcribed here...</em>';
            }
            
            transcriptContent.innerHTML = html;
        }

        // Set up voice service callbacks
        voiceService.setCallbacks({
            onStart: (language) => {
                updateStatus('Recording...', null);
                startBtn.disabled = true;
                startBtn.className = 'control-btn recording';
                stopBtn.disabled = false;
                languageSwitchAlert.style.display = 'none';
                updateStats();
            },
            
            onResult: (result) => {
                if (result.finalTranscript) {
                    finalTranscript += result.finalTranscript + ' ';
                }
                currentTranscript = result.interimTranscript || '';
                
                updateTranscript();
                updateStatus('Recording...', result.confidence);
                updateStats();
            },
            
            onEnd: () => {
                updateStatus('Ready');
                startBtn.disabled = false;
                startBtn.className = 'control-btn';
                stopBtn.disabled = true;
                currentTranscript = '';
                updateTranscript();
                updateStats();
            },
            
            onError: (error) => {
                showError(error.message);
                updateStatus('Error');
                startBtn.disabled = false;
                startBtn.className = 'control-btn';
                stopBtn.disabled = true;
                updateStats();
            },
            
            onLanguageSwitch: (action, data) => {
                if (action === 'suggest-english') {
                    languageSwitchAlert.style.display = 'block';
                } else {
                    // Language was switched
                    const langInfo = voiceService.supportedLanguages[action];
                    if (langInfo) {
                        currentLangEl.textContent = langInfo.name;
                        // Update active language button
                        langButtons.forEach(btn => {
                            btn.classList.toggle('active', btn.dataset.lang === action);
                        });
                    }
                }
                updateStats();
            }
        });

        // Event listeners
        startBtn.addEventListener('click', async () => {
            const started = await voiceService.startRecording();
            if (!started) {
                showError('Failed to start recording. Please check your microphone.');
            }
        });

        stopBtn.addEventListener('click', () => {
            voiceService.stopRecording();
        });

        clearBtn.addEventListener('click', () => {
            finalTranscript = '';
            currentTranscript = '';
            updateTranscript();
            updateStatus('Ready');
            languageSwitchAlert.style.display = 'none';
        });

        // Language selection
        langButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const lang = btn.dataset.lang;
                voiceService.setLanguage(lang);
                
                langButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                currentLangEl.textContent = voiceService.supportedLanguages[lang].name;
                languageSwitchAlert.style.display = 'none';
            });
        });

        // Global functions for language switch alert
        window.switchToEnglish = () => {
            voiceService.setLanguage('en-IN');
            langButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === 'en-IN');
            });
            currentLangEl.textContent = 'English (India)';
            languageSwitchAlert.style.display = 'none';
        };

        window.retryTamil = () => {
            languageSwitchAlert.style.display = 'none';
            // Reset fallback attempts to give Tamil another chance
            voiceService.fallbackAttempts = 0;
        };

        window.dismissAlert = () => {
            languageSwitchAlert.style.display = 'none';
        };

        window.speakPhrase = (element) => {
            const phraseText = element.querySelector('.phrase-text').textContent;
            alert(`Try speaking this phrase:\n\n"${phraseText}"\n\nClick Start Recording first, then speak clearly.`);
        };

        // Initialize
        updateStatus('Ready');
        updateStats();
        console.log('üé§ Hybrid Voice Test initialized!');
    </script>
</body>
</html>